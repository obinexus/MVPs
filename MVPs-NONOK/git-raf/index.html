<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Git-RAF Auto-Tag Governance Demo</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #0a0a0a;
            color: #00ff41;
            margin: 0;
            padding: 20px;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        h1 {
            text-align: center;
            color: #00ff41;
            text-shadow: 0 0 10px #00ff41;
            margin-bottom: 30px;
        }
        
        .demo-section {
            background: #111;
            border: 1px solid #00ff41;
            border-radius: 5px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 0 20px rgba(0, 255, 65, 0.3);
        }
        
        .trie-visualization {
            display: flex;
            justify-content: center;
            margin: 20px 0;
        }
        
        .trie-node {
            position: relative;
            display: inline-block;
            background: #1a1a1a;
            border: 2px solid #00ff41;
            padding: 10px 20px;
            margin: 10px;
            border-radius: 5px;
            transition: all 0.3s ease;
        }
        
        .trie-node:hover {
            background: #00ff41;
            color: #000;
            transform: scale(1.1);
        }
        
        .build-status {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .status-card {
            background: #1a1a1a;
            border: 1px solid #00ff41;
            padding: 15px;
            border-radius: 5px;
            text-align: center;
        }
        
        .metric {
            font-size: 2em;
            color: #00ff41;
            margin: 10px 0;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #333;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff0000, #ffff00, #00ff41);
            transition: width 0.5s ease;
        }
        
        button {
            background: #00ff41;
            color: #000;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        button:hover {
            background: #fff;
            box-shadow: 0 0 10px #00ff41;
        }
        
        .log-output {
            background: #000;
            padding: 15px;
            border-radius: 5px;
            font-size: 0.9em;
            height: 200px;
            overflow-y: auto;
            margin-top: 20px;
            border: 1px solid #00ff41;
        }
        
        .tag-result {
            background: #1a1a1a;
            border: 2px solid #00ff41;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
            display: none;
        }
        
        .governance-metadata {
            background: #0a0a0a;
            padding: 10px;
            margin: 10px 0;
            border-left: 3px solid #00ff41;
            font-size: 0.85em;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 5px #00ff41; }
            50% { box-shadow: 0 0 20px #00ff41; }
            100% { box-shadow: 0 0 5px #00ff41; }
        }
        
        .active-node {
            animation: pulse 1s infinite;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Git-RAF Auto-Tag Governance Demo</h1>
        
        <div class="demo-section">
            <h2>Build Status Dashboard</h2>
            <div class="build-status">
                <div class="status-card">
                    <h3>Artifacts Built</h3>
                    <div class="metric" id="artifact-count">0</div>
                </div>
                <div class="status-card">
                    <h3>Tests Passed</h3>
                    <div class="metric" id="test-pass">0%</div>
                </div>
                <div class="status-card">
                    <h3>Sinphase (σ)</h3>
                    <div class="metric" id="sinphase">0.000</div>
                </div>
                <div class="status-card">
                    <h3>Stability</h3>
                    <div class="metric" id="stability">N/A</div>
                </div>
            </div>
            
            <div class="progress-bar">
                <div class="progress-fill" id="sinphase-bar" style="width: 0%"></div>
            </div>
        </div>
        
        <div class="demo-section">
            <h2>Trie-Based Tag Resolution</h2>
            <div class="trie-visualization">
                <div style="text-align: center;">
                    <div class="trie-node" id="root">Root</div>
                    <div style="display: flex; justify-content: center;">
                        <div style="margin: 0 50px;">
                            <div class="trie-node" id="node-0">0</div>
                            <div style="display: flex;">
                                <div class="trie-node" id="node-00" style="margin: 5px;">RC</div>
                                <div class="trie-node" id="node-01" style="margin: 5px;">Stable</div>
                            </div>
                        </div>
                        <div style="margin: 0 50px;">
                            <div class="trie-node" id="node-1">1</div>
                            <div style="display: flex;">
                                <div class="trie-node" id="node-10" style="margin: 5px;">Hotfix</div>
                                <div class="trie-node" id="node-11" style="margin: 5px;">Release</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="demo-section">
            <h2>Build & Tag Controls</h2>
            <div style="text-align: center;">
                <button onclick="simulateBuild('poor')">Simulate Poor Build</button>
                <button onclick="simulateBuild('average')">Simulate Average Build</button>
                <button onclick="simulateBuild('good')">Simulate Good Build</button>
                <button onclick="simulateBuild('excellent')">Simulate Excellent Build</button>
            </div>
            
            <div class="log-output" id="log-output">
                [Git-RAF] Waiting for build simulation...
            </div>
        </div>
        
        <div class="tag-result" id="tag-result">
            <h2>Generated Tag</h2>
            <div style="font-size: 1.5em; color: #00ff41; margin: 10px 0;" id="tag-name"></div>
            
            <div class="governance-metadata">
                <h3>RAF Governance Metadata</h3>
                <pre id="governance-data"></pre>
            </div>
            
            <div style="text-align: center; margin-top: 20px;">
                <button onclick="applyTag()">Apply Tag</button>
                <button onclick="pushTag()">Push to Remote</button>
            </div>
        </div>
    </div>
    
    <script>
        let currentBuild = null;
        
        function log(message) {
            const output = document.getElementById('log-output');
            const timestamp = new Date().toISOString().substr(11, 8);
            output.innerHTML += `\n[${timestamp}] ${message}`;
            output.scrollTop = output.scrollHeight;
        }
        
        function updateMetrics(artifacts, testPass, sinphase, stability) {
            document.getElementById('artifact-count').textContent = artifacts;
            document.getElementById('test-pass').textContent = testPass + '%';
            document.getElementById('sinphase').textContent = sinphase.toFixed(3);
            document.getElementById('stability').textContent = stability;
            
            // Update progress bar
            const percentage = Math.min(sinphase * 100, 100);
            document.getElementById('sinphase-bar').style.width = percentage + '%';
        }
        
        function highlightTrieNode(stability) {
            // Reset all nodes
            document.querySelectorAll('.trie-node').forEach(node => {
                node.classList.remove('active-node');
            });
            
            // Highlight path based on stability
            const nodeMap = {
                'alpha': ['root', 'node-0'],
                'beta': ['root', 'node-1'],
                'rc': ['root', 'node-0', 'node-00'],
                'stable': ['root', 'node-0', 'node-01'],
                'hotfix': ['root', 'node-1', 'node-10'],
                'release': ['root', 'node-1', 'node-11']
            };
            
            if (nodeMap[stability]) {
                nodeMap[stability].forEach(nodeId => {
                    document.getElementById(nodeId).classList.add('active-node');
                });
            }
        }
        
        function generateVersion() {
            const major = Math.floor(Math.random() * 3) + 1;
            const minor = Math.floor(Math.random() * 10);
            const patch = Math.floor(Math.random() * 20);
            return `v${major}.${minor}.${patch}`;
        }
        
        function simulateBuild(quality) {
            log('=== Starting build simulation ===');
            log('Quality level: ' + quality);
            
            // Simulate build metrics based on quality
            const metrics = {
                'poor': { artifacts: 3, testPass: 20, sinphase: 0.15 },
                'average': { artifacts: 8, testPass: 60, sinphase: 0.48 },
                'good': { artifacts: 12, testPass: 85, sinphase: 0.72 },
                'excellent': { artifacts: 15, testPass: 98, sinphase: 0.94 }
            };
            
            const build = metrics[quality];
            currentBuild = build;
            
            // Simulate build process
            log('Compiling DIRAM components...');
            setTimeout(() => {
                log(`Generated ${build.artifacts} artifacts`);
                log('Running test suite...');
                
                setTimeout(() => {
                    log(`Test results: ${build.testPass}% passed`);
                    log(`Calculating sinphase metric...`);
                    
                    setTimeout(() => {
                        log(`Sinphase (σ) = ${build.sinphase.toFixed(3)}`);
                        
                        // Determine stability
                        let stability;
                        if (build.sinphase >= 0.8) stability = 'release';
                        else if (build.sinphase >= 0.6) stability = 'stable';
                        else if (build.sinphase >= 0.4) stability = 'rc';
                        else if (build.sinphase >= 0.2) stability = 'beta';
                        else stability = 'alpha';
                        
                        build.stability = stability;
                        
                        updateMetrics(build.artifacts, build.testPass, build.sinphase, stability);
                        highlightTrieNode(stability);
                        
                        if (build.sinphase >= 0.5) {
                            log(`✓ Build meets stability threshold (σ ≥ 0.5)`);
                            log(`Stability classification: ${stability}`);
                            generateTag(build);
                        } else {
                            log(`✗ Build below stability threshold (σ < 0.5)`);
                            log('Tag creation aborted - build not stable enough');
                        }
                    }, 1000);
                }, 1500);
            }, 1000);
        }
        
        function generateTag(build) {
            const version = generateVersion();
            const tagName = `diram-stable-${version}-${build.stability}`;
            
            log('Generating governance metadata...');
            
            const metadata = {
                'Policy-Tag': build.stability,
                'Governance-Ref': 'diram_build_policy.rift.gov',
                'Entropy-Checksum': 'sha3_' + Math.random().toString(36).substr(2, 9),
                'Governance-Vector': `[build_risk: ${(1 - build.sinphase).toFixed(2)}, rollback_cost: 0.15, stability_impact: ${build.sinphase.toFixed(2)}]`,
                'AuraSeal': 'seal_' + Math.random().toString(36).substr(2, 16),
                'Build-Timestamp': new Date().toISOString(),
                'Artifact-Count': build.artifacts
            };
            
            document.getElementById('tag-name').textContent = tagName;
            document.getElementById('governance-data').textContent = JSON.stringify(metadata, null, 2);
            document.getElementById('tag-result').style.display = 'block';
            
            log(`✓ Tag ready: ${tagName}`);
        }
        
        function applyTag() {
            if (!currentBuild || !currentBuild.stability) {
                log('✗ No valid build to tag');
                return;
            }
            
            log('Applying tag to current commit...');
            setTimeout(() => {
                log('✓ Tag applied successfully');
                log('Tag signed with GPG key');
            }, 1000);
        }
        
        function pushTag() {
            log('Pushing tag to remote repository...');
            setTimeout(() => {
                log('✓ Tag pushed to origin');
                log('Remote: https://github.com/obinexus/diram.git');
            }, 1500);
        }
        
        // Initialize
        log('Git-RAF Auto-Tag System initialized');
        log('Minimum sinphase threshold: 0.5');
    </script>
</body>
</html>